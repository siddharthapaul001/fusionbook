function _pluckSize(size,str){if(!size)return console.error("Error in size value "+str+": "+size),null;str=str?"of "+str:"";let l=((size+="")+"").length,unit=size.slice(-2);return"px"===unit?+size.slice(l-2):NaN!==+unit?+size:null}function _pluckNumber(num,precision=0){if(num){if(+num||0==+num)return(+num).toFixed(precision);console.error("Incorrect value: "+num)}return null}function _validateColorCode(color){if(!color)return!1;if("number"==typeof color)return console.error("Incorrect color specified"),!1;if(color.startsWith("#")){if(isNaN(parseInt(color.slice(1),16))||4!==color.length&&7!==color.length)return console.error("Incorrect hex color code"),!1}else if(color.startsWith("rgb(")&&!color.replace(/\s/g,"").match(/^rgb\((\d+),(\d+),(\d+)\)$/g))return console.error("Incorrect rgb color code"),!1;return color}function _isFraction(num){return!(Math.abs(num-Math.floor(num))<Number.EPSILON)}function _getPathString(side){let str,cx=.3,ex=.3;return ex*=.5,str=" l"+.15*side+","+.3*side+" h"+.35*side+" l-"+(cx=.5*(.7-.3))*side+","+.3*side+" l"+cx*side+","+(.7-.3)*side+" l-"+.5*side+",-"+.25*side+" l-"+.5*side+","+.25*side+" l"+cx*side+",-"+(.7-.3)*side+" l-"+cx*side+",-"+.3*side+" h"+.35*side+" z"}class SVGElement{constructor(tag){this._elem=document.createElementNS("http://www.w3.org/2000/svg",tag),this.attrs={}}getNode(){return this._elem}removeNode(){this._elem.parentNode.removeChild(this._elem)}appendChild(child){child instanceof Node?this._elem.appendChild(child):child instanceof SVGElement?this._elem.appendChild(child.getNode()):console.error("Child must be Node or SVGElement")}removeChild(child){child instanceof Node?this._elem.removeChild(child):child instanceof SVGElement?this._elem.removeChild(child.getNode()):console.error("Child must be Node or SVGElement")}setAttributes(attrs){let hasChange=!1;for(let attrName in attrs)this.attrs[attrName]!==attrs[attrName]&&(this._elem.setAttribute(attrName,attrs[attrName]),this.attrs[attrName]=attrs[attrName],hasChange=!0);return hasChange}}class Definition{constructor(svg){this.defs=new SVGElement("defs"),this.linearGradient=new SVGElement("linearGradient"),this.strokeLinearGradient=new SVGElement("linearGradient"),this.Rated=new SVGElement("stop"),this.NonRated=new SVGElement("stop"),this.strokeRated=new SVGElement("stop"),this.strokeNonRated=new SVGElement("stop"),this.linearGradient.appendChild(this.Rated),this.linearGradient.appendChild(this.NonRated),this.strokeLinearGradient.appendChild(this.strokeRated),this.strokeLinearGradient.appendChild(this.strokeNonRated),this.defs.appendChild(this.linearGradient),this.defs.appendChild(this.strokeLinearGradient),this._config={},svg.addDefinition(this)}update(rating,ratedFill,nonratedFill,ratedStroke,nonratedStroke,direction,flow){let ratingFraction=(rating-Math.floor(rating)).toFixed(2),commonLinearGradient={x1:"0%",x2:"row"==direction?"100%":"0%",y1:"0%",y2:"column"==direction?"100%":"0%"};ratingFraction===this._config.ratingFraction&&this._config.ratedFill===ratedFill&&this._config.nonratedFill===nonratedFill&&this._config.ratedStroke===ratedStroke&&this._config.direction===direction&&this._config.flow===flow||(this._config.ratingFraction=ratingFraction,this._config.ratedFill=ratedFill,this._config.nonratedFill=nonratedFill,this._config.ratedStroke=ratedStroke,this._config.direction=direction,this._config.flow=flow,this.linearGradient.setAttributes({id:"partial-fill",...commonLinearGradient}),this.strokeLinearGradient.setAttributes({id:"partial-stroke",...commonLinearGradient}),"reverse"==flow&&([ratedFill,nonratedFill]=[nonratedFill,ratedFill],[ratedStroke,nonratedStroke]=[nonratedStroke,ratedStroke]),this.Rated.setAttributes({offset:100*ratingFraction+"%",style:"stop-color:"+ratedFill+";stop-opacity:1;"}),this.NonRated.setAttributes({offset:100*ratingFraction+"%",style:"stop-color:"+nonratedFill+";stop-opacity:1;"}),this.strokeRated.setAttributes({offset:100*ratingFraction+"%",style:"stop-color:"+ratedStroke+";stop-opacity:1;"}),this.strokeNonRated.setAttributes({offset:100*ratingFraction+"%",style:"stop-color:"+nonratedStroke+";stop-opacity:1;"}))}}class SVGContainer extends SVGElement{constructor(parentElement,height,width){super("svg"),this.getNode().setAttribute("xmlns","https://www.w3.org/2000/svg"),parentElement.appendChild(this.getNode()),this.setAttributes({height:height,width:width}),[height,width]=this.getSize(),this.height=height,this.width=width}getSize(){let rect=this.getNode().getBoundingClientRect();return[rect.height,rect.width]}getDefinition(){return this._def}addDefinition(def){def instanceof Definition&&(this.appendChild(def.defs),this._def=def)}update(height,width){return this.setAttributes({height:height,width:width})&&(this.height=height,this.width=width),[this.height,this.width]}}class StarRating{constructor(parentElement,attribs){if(!(parentElement instanceof HTMLElement))return console.error("A HTML Element must be provided in the first argument"),null;if(this._elements={},this._config={},this._internalConfig={},this._onDraw={},this._drawnState={},this._onDefinition=[],this._elements.parentElement=parentElement,this._config.height=400,this._config.width=400,this._config.TotalStars=5,this._config.rating=void 0,this._config.orientation="left-to-right",this._config.padding=1,this._config.justifyContent="center",this._config.alignItems="center",this._config.strokeWidth=0,this._config.ratedFill="#ff0",this._config.nonratedFill="#ddd",this._config.ratedStroke="none",this._config.nonratedStroke="none",this._internalConfig.direction="row",this._internalConfig.flow="",this._elements.svg=new SVGContainer(parentElement,this._config.height,this._config.width),this._elements.stars=[],attribs){if(!this._validateAndSet(attribs))return this._elements.svg.removeNode(),console.error("Stopping execution"),null;this._calculateSide(this._config.padding,this._config.strokeWidth),this._internalConfig.requestedAnimationFrame=!0,window.requestAnimationFrame(()=>{this._draw()})}else this._calculateSide(this._config.padding,this._config.strokeWidth),this._internalConfig.requestedAnimationFrame=!0,window.requestAnimationFrame(()=>{this._draw()})}_calculateSide(padding,strokeWidth){let side,sideOut;if(sideOut="row"===this._internalConfig.direction?this._config.width/this._config.TotalStars:this._config.width,sideOut=(side="column"===this._internalConfig.direction?this._config.height/this._config.TotalStars:this._config.height)<sideOut?side:sideOut,void 0!==strokeWidth&&(strokeWidth<0||strokeWidth>.1*sideOut?console.error("Incorrect strokeWidth setting to default"):this._config.strokeWidth=strokeWidth),void 0!==padding&&(padding<1||padding>.1*sideOut?console.error("Incorrect padding setting to default"):this._config.padding=1),(side=sideOut-2*this._config.padding-2*this._config.strokeWidth)<10)return!1;side===this._internalConfig.side&&sideOut===this._internalConfig.sideOut||(this._internalConfig.side=side,this._internalConfig.sideOut=sideOut)}_calculateBaseShift(){let xShift=0,yShift=0,baseX=0,baseY=0;this._onDraw._calculateBaseShift&&("row"==this._internalConfig.direction?(xShift=this._internalConfig.sideOut,"start"==this._config.justifyContent?baseX=this._internalConfig.sideOut/2:"center"==this._config.justifyContent?baseX=this._internalConfig.sideOut/2+(this._config.width-this._internalConfig.sideOut*this._config.TotalStars)/2:"end"==this._config.justifyContent?baseX=this._config.width-this._internalConfig.sideOut*this._config.TotalStars+this._internalConfig.sideOut/2:"space-evenly"==this._config.justifyContent&&(baseX=(xShift=this._config.width/this._config.TotalStars)/2),"center"==this._config.alignItems?baseY=(this._internalConfig.sideOut-this._internalConfig.side)/2+(this._config.height-this._internalConfig.sideOut)/2:"start"==this._config.alignItems?baseY=(this._internalConfig.sideOut-this._internalConfig.side)/2:"end"==this._config.alignItems&&(baseY=this._config.height-this._internalConfig.sideOut)):"column"==this._internalConfig.direction&&(yShift=this._internalConfig.sideOut,"start"==this._config.justifyContent?baseY=(this._internalConfig.sideOut-this._internalConfig.side)/2:"center"==this._config.justifyContent?baseY=(this._internalConfig.sideOut-this._internalConfig.side)/2:"end"==this._config.justifyContent?baseY=this._config.height-this._internalConfig.sideOut*this._config.TotalStars:"space-evenly"==this._config.justifyContent&&(baseY=((yShift=this._config.height/this._config.TotalStars)-this._internalConfig.side)/2),"center"==this._config.alignItems?baseX=this._internalConfig.sideOut/2+(this._config.width-this._internalConfig.sideOut)/2:"start"==this._config.alignItems?baseX=this._internalConfig.sideOut/2:"end"==this._config.alignItems&&(baseX=this._config.width-this._internalConfig.sideOut/2)),this._internalConfig.baseX!==baseX&&(this._internalConfig.baseX=baseX),this._internalConfig.baseY!==baseY&&(this._internalConfig.baseY=baseY),this._internalConfig.xShift!==xShift&&(this._internalConfig.xShift=xShift),this._internalConfig.yShift!==yShift&&(this._internalConfig.yShift=yShift),this._onDraw._reassignPath=!0)}_validateAndSet(attribs){let correctValue,strokeWidth,padding;return void 0!==attribs.orientation&&["left-to-right","right-to-left","top-to-bottom","bottom-to-top"].includes(attribs.orientation)&&correctValue!==this._config.orientation&&(this._config.orientation=attribs.orientation,attribs.direction="top-to-bottom"===attribs.orientation||"bottom-to-top"===attribs.orientation?"column":"row",this._internalConfig.direction!==attribs.direction&&(this._internalConfig.direction=direction),this._internalConfig.flow="left-to-right"===attribs.orientation||"top-to-bottom"===attribs.orientation?"":"reverse"),void 0!==attribs.height&&(correctValue=_pluckSize(attribs.height))&&correctValue>=20&&correctValue!==this._config.height&&(this._config.height=correctValue),void 0!==attribs.width&&(correctValue=_pluckSize(attribs.width))&&correctValue>=20&&correctValue!==this._config.width&&(this._config.width=correctValue),void 0!==attribs.stars&&((correctValue=+attribs.stars)>0&&correctValue!==this._config.TotalStars?this._config.TotalStars=correctValue:correctValue||console.error("Incorrect value for stars: "+attribs.stars)),void 0!==attribs.padding&&(correctValue=_pluckSize(attribs.padding))&&correctValue!==this._config.padding&&(padding=correctValue),void 0!==attribs.strokeWidth&&(correctValue=_pluckSize(attribs.strokeWidth))&&correctValue!==this._config.strokeWidth&&(strokeWidth=correctValue),void 0!==attribs.rating&&((correctValue=+attribs.rating)>=0&&correctValue<=this._config.TotalStars&&correctValue!==this._config.rating?this._config.rating=correctValue:correctValue||console.log("Incorrect rating value: "+attribs.rating)),void 0!==attribs.justifyContent&&["start","end","center","space-evenly"].includes(attribs.justifyContent)&&attribs.justifyContent!==this._config.justifyContent&&(this._config.justifyContent=attribs.justifyContent),void 0!==attribs.alignItems&&["start","end","center"].includes(attribs.alignItems)&&attribs.alignItems!==this._config.alignItems&&(this._config.alignItems=attribs.alignItems),void 0!==attribs.ratedFill&&((correctValue=_validateColorCode(attribs.ratedFill))&&correctValue!==this._config.ratedFill?this._config.ratedFill=correctValue:correctValue||console.error("Incorrect color for ratedFill: "+attribs.ratedFill)),void 0!==attribs.nonratedFill&&((correctValue=_validateColorCode(attribs.nonratedFill))&&correctValue!==this._config.nonratedFill?this._config.nonratedFill=correctValue:correctValue||console.error("Incorrect color for ratedFill: "+attribs.nonratedFill)),void 0!==attribs.ratedStroke&&((correctValue=_validateColorCode(attribs.ratedStroke))&&correctValue!==this._config.ratedStroke?this._config.ratedStroke=correctValue:correctValue||console.error("Incorrect color for ratedFill: "+attribs.ratedStroke)),void 0!==attribs.nonratedStroke&&((correctValue=_validateColorCode(attribs.nonratedStroke))&&correctValue!==this._config.nonratedStroke?this._config.nonratedStroke=correctValue:correctValue||console.error("Incorrect color for ratedFill: "+attribs.nonratedStroke)),{}._calculateSide&&this._calculateSide(padding,strokeWidth),!0}_draw(){this._internalConfig.requestedAnimationFrame=!1,"function"==typeof this.onPreDraw?this.onPreDraw():this.onDraw&&console.error("onDraw must be a function");let i,j,rating=this._config.rating||0==this._config.rating?this._config.rating:this._config.TotalStars,currentStars=this._elements.stars.length;this._internalConfig.relativePath=_getPathString(this._internalConfig.side),this._elements.svg.update(this._config.height,this._config.width);let defs=this._elements.svg.getDefinition();for(_isFraction(rating)&&(defs||(defs=new Definition(this._elements.svg)),defs.update(rating,this._config.ratedFill,this._config.nonratedFill,this._config.ratedStroke,this._config.nonratedStroke,this._internalConfig.direction,this._internalConfig.flow)),this._calculateBaseShift(),i=0;i<Math.max(currentStars,this._config.TotalStars);i++){if(j="reverse"==this._internalConfig.flow?this._config.TotalStars-i-1:i,i>=currentStars){let star=new SVGElement("path");this._elements.stars.push(star),this._elements.svg.appendChild(star)}else i>=this._config.TotalStars&&this._elements.stars.pop().removeNode();i<this._config.TotalStars&&(_isFraction(rating)&&Math.ceil(rating)==j+1?this._elements.stars[i].setAttributes({fill:"url(#partial-fill)",stroke:"url(#partial-stroke)","stroke-width":this._config.strokeWidth+"px",d:"M"+(this._internalConfig.baseX+this._internalConfig.xShift*i)+","+(this._internalConfig.baseY+this._internalConfig.yShift*i)+" "+this._internalConfig.relativePath}):this._elements.stars[i].setAttributes({fill:j<Math.ceil(rating)?this._config.ratedFill:this._config.nonratedFill,stroke:j<Math.ceil(rating)?this._config.ratedStroke:this._config.nonratedStroke,"stroke-width":this._config.strokeWidth+"px",d:"M"+(this._internalConfig.baseX+this._internalConfig.xShift*i)+","+(this._internalConfig.baseY+this._internalConfig.yShift*i)+" "+this._internalConfig.relativePath}))}"function"==typeof this.onDraw?this.onDraw():this.onDraw&&console.error("onDraw must be a function")}update(attribs){if(attribs){if(!this._validateAndSet(attribs))return console.error("Stopping execution"),null;this._internalConfig.requestedAnimationFrame||(window.requestAnimationFrame(()=>{this._draw()}),this._internalConfig.requestedAnimationFrame=!0)}"function"==typeof this.onUpdate?this.onUpdate(this._config):this.onUpdate&&console.error("onUpdate must be a function")}}export default StarRating;